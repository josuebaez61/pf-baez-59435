import{a as m}from"./chunk-43RDNZS3.js";import{c as d,d as f,e as A,n as U,o as g,p as S,u,v}from"./chunk-VED7TU6T.js";import{b as p,k as l}from"./chunk-YSMQIVPS.js";import{a as n,b as a,ia as h,na as s,v as c}from"./chunk-EVXATCS4.js";var o=f({source:"Auth",events:{"Set Authenticated User":d(),"Unset Authenticated User":A()}});var k="auth",x={authenticatedUser:null},L=v(x,u(o.setAuthenticatedUser,(e,$)=>a(n({},e),{authenticatedUser:$.user})),u(o.unsetAuthenticatedUser,e=>a(n({},e),{authenticatedUser:null})));var I=S(k),R=g(I,e=>e.authenticatedUser);var K=(()=>{class e{router;httpClient;store;authUser$;baseURL=m.apiBaseURL;constructor(t,r,i){this.router=t,this.httpClient=r,this.store=i,this.authUser$=this.store.select(R)}handleAuthentication(t){return t[0]?(this.store.dispatch(o.setAuthenticatedUser({user:t[0]})),localStorage.setItem("token",t[0].token),t[0]):null}login(t){return this.httpClient.get(`${this.baseURL}/users?email=${t.email}&password=${t.password}`).pipe(c(r=>{let i=this.handleAuthentication(r);if(i)return i;throw new Error("Los datos son invalidos")}))}logout(){this.store.dispatch(o.unsetAuthenticatedUser()),localStorage.removeItem("token"),this.router.navigate(["auth","login"])}verifyToken(){return this.httpClient.get(`${this.baseURL}/users?token=${localStorage.getItem("token")}`).pipe(c(t=>!!this.handleAuthentication(t)))}static \u0275fac=function(r){return new(r||e)(s(l),s(p),s(U))};static \u0275prov=h({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();export{k as a,L as b,K as c};
